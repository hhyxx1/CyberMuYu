# 赛博木鱼项目修复计划

## 问题分析
根据用户提供的日志和lx-music-desktop项目的实现，我发现赛博木鱼项目中关于自定义音源的实现存在以下问题：

1. **手动注册内置音源** - 不符合lx-music-desktop的实现，应该通过IPC通信或事件驱动的方式初始化音源
2. **音乐URL获取动作错误** - 使用了`getMusicUrl`动作，而lx-music-desktop使用的是`musicUrl`动作
3. **API调用返回格式错误** - 自定义音源的API调用应该返回包含`promise`和`canceleFn`的对象，而不是直接返回Promise
4. **搜索功能实现错误** - 不符合lx-music-desktop的搜索实现
5. **lx-music API环境模拟不完整** - 不符合lx-music-desktop的API环境

## 修复方案

### 1. 修改lx-music API环境模拟
**文件**: `script.js`
**修改内容**:
- 移除手动注册内置音源的代码
- 完善lx-music API环境模拟，使其更符合lx-music-desktop的实现
- 添加userApi对象，用于管理自定义音源

### 2. 修改搜索功能
**文件**: `script.js`
**修改内容**:
- 修改`searchMusic`方法，使其符合lx-music-desktop的搜索实现
- 移除模拟搜索结果的代码
- 添加事件驱动的搜索实现

### 3. 修改音乐URL获取功能
**文件**: `script.js`
**修改内容**:
- 修改`getMusicUrlFromSource`方法，使其使用`musicUrl`动作
- 修改返回格式，使其返回包含`promise`和`canceleFn`的对象
- 添加错误处理

### 4. 修改播放功能
**文件**: `script.js`
**修改内容**:
- 修改`playMusic`方法，使其正确处理自定义音源返回的URL
- 添加错误处理
- 修改音频元素的创建和播放逻辑

### 5. 修改事件处理
**文件**: `script.js`
**修改内容**:
- 完善事件处理逻辑，使其符合lx-music-desktop的实现
- 添加事件监听器，用于处理自定义音源返回的结果

## 预期效果

1. **野花音源加载成功** - 能够正确加载和初始化野花音源
2. **搜索功能正常工作** - 能够通过自定义音源搜索音乐
3. **音乐播放正常** - 能够通过自定义音源获取音乐URL并播放
4. **符合lx-music-desktop实现** - 代码实现符合lx-music-desktop项目的规范

## 修复步骤

1. 首先修改lx-music API环境模拟
2. 然后修改搜索功能
3. 接着修改音乐URL获取功能
4. 再修改播放功能
5. 最后修改事件处理

## 注意事项

1. 严格按照lx-music-desktop项目的实现进行修改
2. 确保API调用的动作名称和参数格式正确
3. 确保返回格式符合lx-music-desktop的规范
4. 添加适当的错误处理
5. 确保代码的可读性和可维护性